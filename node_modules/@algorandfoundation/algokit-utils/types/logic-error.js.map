{"version":3,"file":"logic-error.js","sources":["../../src/types/logic-error.ts"],"sourcesContent":["import type algosdk from 'algosdk'\n\nconst LOGIC_ERROR = /transaction ([A-Z0-9]+): logic eval error: (.*). Details: .*pc=([0-9]+).*/\n\n/**\n * Details about a smart contract logic error\n */\nexport interface LogicErrorDetails {\n  /** The ID of the transaction with the logic error */\n  txId: string\n  /** The program counter where the error was */\n  pc: number\n  /** The error message */\n  msg: string\n  /** The full error description */\n  desc: string\n  /** Any trace information included in the error */\n  traces: Record<string, unknown>[]\n}\n\n/** Wraps key functionality around processing logic errors */\nexport class LogicError extends Error {\n  /** Takes an error message and parses out the details of any logic errors in there.\n   * @param error The error message to parse\n   * @returns The logic error details if any, or undefined\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  static parseLogicError(error: any): LogicErrorDetails | undefined {\n    const errorMessage = error.message\n    const res = LOGIC_ERROR.exec(errorMessage)\n    if (res === null || res.length <= 3) return undefined\n\n    return {\n      txId: res[1],\n      msg: res[2],\n      desc: errorMessage,\n      pc: parseInt(res[3] ? res[3] : '0'),\n      traces: error.traces,\n    } as LogicErrorDetails\n  }\n\n  public led: LogicErrorDetails\n  public program: string[]\n  public lines = 5\n  public teal_line = 0\n  override stack?: string\n\n  /**\n   * Create a new logic error object.\n   * @param errorDetails The details of the logic error\n   * @param program The TEAL source code, split by line\n   * @param map The source map of the TEAL source code\n   */\n  constructor(errorDetails: LogicErrorDetails, program: string[], map: algosdk.SourceMap) {\n    super()\n    this.led = errorDetails\n    this.program = program\n\n    const line = map.getLineForPc(errorDetails.pc)\n    this.teal_line = line === undefined ? 0 : line\n\n    this.message = `${this.led.msg}. at:${line}. ${this.led.desc}`\n\n    if (this.teal_line > 0) {\n      const start = this.teal_line > this.lines ? this.teal_line - this.lines : 0\n      const stop = program.length > this.teal_line + this.lines ? this.teal_line + this.lines : program.length\n\n      const stack_lines = program.slice(start, stop)\n\n      stack_lines[stack_lines.length / 2] += ' <--- Error'\n\n      this.stack = stack_lines.join('\\n')\n    }\n  }\n}\n"],"names":[],"mappings":";;AAEA,MAAM,WAAW,GAAG,2EAA2E,CAAA;AAkB/F;AACM,MAAO,UAAW,SAAQ,KAAK,CAAA;AACnC;;;AAGG;;IAEH,OAAO,eAAe,CAAC,KAAU,EAAA;AAC/B,QAAA,MAAM,YAAY,GAAG,KAAK,CAAC,OAAO,CAAA;QAClC,MAAM,GAAG,GAAG,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;QAC1C,IAAI,GAAG,KAAK,IAAI,IAAI,GAAG,CAAC,MAAM,IAAI,CAAC;AAAE,YAAA,OAAO,SAAS,CAAA;QAErD,OAAO;AACL,YAAA,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC;AACZ,YAAA,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC;AACX,YAAA,IAAI,EAAE,YAAY;AAClB,YAAA,EAAE,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;YACnC,MAAM,EAAE,KAAK,CAAC,MAAM;SACA,CAAA;KACvB;AAQD;;;;;AAKG;AACH,IAAA,WAAA,CAAY,YAA+B,EAAE,OAAiB,EAAE,GAAsB,EAAA;AACpF,QAAA,KAAK,EAAE,CAAA;QAXF,IAAK,CAAA,KAAA,GAAG,CAAC,CAAA;QACT,IAAS,CAAA,SAAA,GAAG,CAAC,CAAA;AAWlB,QAAA,IAAI,CAAC,GAAG,GAAG,YAAY,CAAA;AACvB,QAAA,IAAI,CAAC,OAAO,GAAG,OAAO,CAAA;QAEtB,MAAM,IAAI,GAAG,GAAG,CAAC,YAAY,CAAC,YAAY,CAAC,EAAE,CAAC,CAAA;AAC9C,QAAA,IAAI,CAAC,SAAS,GAAG,IAAI,KAAK,SAAS,GAAG,CAAC,GAAG,IAAI,CAAA;AAE9C,QAAA,IAAI,CAAC,OAAO,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAQ,KAAA,EAAA,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAA;AAE9D,QAAA,IAAI,IAAI,CAAC,SAAS,GAAG,CAAC,EAAE;YACtB,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,GAAG,CAAC,CAAA;AAC3E,YAAA,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC,MAAM,CAAA;YAExG,MAAM,WAAW,GAAG,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;YAE9C,WAAW,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,aAAa,CAAA;YAEpD,IAAI,CAAC,KAAK,GAAG,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;SACpC;KACF;AACF;;;;"}